<% layout('/layout/boilerplate') %>

<section class="my-bookings-section container my-5">
  <h2 class="text-center mb-4 text-danger fw-bold">My Trips</h2>

  <!-- ðŸ§­ Tabs Navigation -->
  <ul class="nav nav-pills justify-content-center mb-4 gap-2" id="bookingTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active rounded-pill px-4" id="upcoming-tab" data-bs-toggle="pill"
        data-bs-target="#upcoming" type="button" role="tab">
        <i class="fa-solid fa-calendar-check me-1"></i> Upcoming
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link rounded-pill px-4" id="past-tab" data-bs-toggle="pill"
        data-bs-target="#past" type="button" role="tab">
        <i class="fa-solid fa-clock-rotate-left me-1"></i> Past Stays
      </button>
    </li>
  </ul>

  <div class="tab-content" id="bookingTabsContent">

    <!-- ðŸŸ¢ Upcoming Bookings -->
    <div class="tab-pane fade show active" id="upcoming" role="tabpanel">
      <% if (upcoming.length === 0) { %>
        <div class="text-center py-5">
          <i class="fa-solid fa-calendar-xmark text-muted mb-3" style="font-size: 3rem;"></i>
          <h5 class="text-muted">You have no upcoming stays.</h5>
          <a href="/listings" class="btn btn-danger mt-3 rounded-pill px-4">
            <i class="fa-solid fa-house"></i> Explore Listings
          </a>
        </div>
      <% } else { %>
        <div class="row g-4 justify-content-center">
          <% upcoming.forEach(booking => { %>
            <div class="col-md-6 col-lg-4">
              <div class="booking-card shadow-sm rounded-4 overflow-hidden bg-white hover-card">
                <div class="booking-img position-relative">
                  <img src="<%= booking.listing.image?.url || 'https://via.placeholder.com/400x250' %>"
                       class="img-fluid"
                       style="width:100%; height:200px; object-fit:cover;"
                       alt="<%= booking.listing.title %>">
                  <div class="price-tag position-absolute top-0 end-0 bg-danger text-white px-3 py-1 rounded-start">
                    â‚¹<%= booking.listing.price.toLocaleString('en-IN') %>/night
                  </div>
                </div>
                <div class="booking-info p-3">
                  <h5 class="fw-bold text-danger mb-1"><%= booking.listing.title %></h5>
                  <p class="text-muted mb-1">
                    <i class="fa-solid fa-location-dot"></i> 
                    <%= booking.listing.location %>, <%= booking.listing.country %>
                  </p>
                  <p class="mb-1"><strong>Check-in:</strong> <%= new Date(booking.checkIn).toDateString() %></p>
                  <p class="mb-1"><strong>Check-out:</strong> <%= new Date(booking.checkOut).toDateString() %></p>
                  <p class="mb-3"><strong>Guests:</strong> <%= booking.guests %></p>

                  <div class="d-flex justify-content-between gap-2">
                    <a href="/listings/<%= booking.listing._id %>"
                       class="btn btn-outline-danger flex-fill rounded-pill">
                      View
                    </a>

                    <form action="/bookings/<%= booking._id %>?_method=DELETE"
                          method="POST" class="flex-fill"
                          onsubmit="return confirm('Are you sure you want to cancel this booking?');">
                      <button type="submit"
                              class="btn btn-outline-secondary w-100 rounded-pill">
                        Cancel
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <!-- ðŸ•“ Past Bookings -->
    <div class="tab-pane fade" id="past" role="tabpanel">
      <% if (past.length === 0) { %>
        <div class="text-center py-5">
          <i class="fa-solid fa-clock text-muted mb-3" style="font-size: 3rem;"></i>
          <h5 class="text-muted">You have no past stays yet.</h5>
        </div>
      <% } else { %>
        <div class="row g-4 justify-content-center">
          <% past.forEach(booking => { %>
            <div class="col-md-6 col-lg-4">
              <div class="booking-card shadow-sm rounded-4 overflow-hidden bg-light hover-card">
                <div class="booking-img position-relative">
                  <img src="<%= booking.listing.image?.url || 'https://via.placeholder.com/400x250' %>"
                       class="img-fluid"
                       style="width:100%; height:200px; object-fit:cover;"
                       alt="<%= booking.listing.title %>">
                </div>
                <div class="booking-info p-3">
                  <h5 class="fw-bold text-secondary mb-1"><%= booking.listing.title %></h5>
                  <p class="text-muted mb-1">
                    <i class="fa-solid fa-location-dot"></i> 
                    <%= booking.listing.location %>, <%= booking.listing.country %>
                  </p>
                  <p class="mb-1"><strong>Stayed:</strong> 
                    <%= new Date(booking.checkIn).toDateString() %> - 
                    <%= new Date(booking.checkOut).toDateString() %>
                  </p>
                  <p class="mb-2"><strong>Guests:</strong> <%= booking.guests %></p>
                  <a href="/listings/<%= booking.listing._id %>"
                     class="btn btn-outline-secondary w-100 rounded-pill">
                    View Again
                  </a>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
</section>

<!-- ðŸŽ¨ Styles -->
<style>
  .booking-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
  }
  .price-tag {
    font-size: 0.9rem;
    font-weight: 500;
  }
  .nav-pills .nav-link.active {
    background-color: #ff385c !important;
    color: #fff !important;
  }
  .nav-pills .nav-link {
    color: #555;
    transition: 0.3s;
  }
  .nav-pills .nav-link:hover {
    background-color: #ffe6ea;
    color: #ff385c;
  }
  @media (max-width: 768px) {
    .booking-card img {
      height: 180px;
    }
    .nav-pills {
      flex-wrap: wrap;
    }
  }
</style>
